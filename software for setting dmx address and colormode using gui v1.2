// this code allow us to generete an gui app for setting the dmx address and color over dmx

// for makking .exe of app you should run this commadn pyinstaller --onefile --noconsole --icon=icon.ico set_dmx_gui.py

import customtkinter as ctk
import serial
import serial.tools.list_ports
import time

# GUI settings
ctk.set_appearance_mode("System")
ctk.set_default_color_theme("blue")

# Main Window
app = ctk.CTk()
app.geometry("400x300")
app.title("DMX Address Config Tool")

def get_ports():
    ports = serial.tools.list_ports.comports()
    return [port.device for port in ports]

def send_config():
    try:
        port = port_menu.get()
        address = int(address_entry.get())
        color_mode = 0x03 if color_mode_menu.get() == "RGB" else 0x04
        device_id = 0x1234

        frame = bytearray()
        frame.append(0xBB)
        frame.append((device_id >> 8) & 0xFF)
        frame.append(device_id & 0xFF)
        frame.append((address >> 8) & 0xFF)
        frame.append(address & 0xFF)
        frame.append(color_mode)

        ser = serial.Serial(port=port, baudrate=250000, bytesize=8, parity='N', stopbits=2, timeout=1)
        ser.break_condition = True
        time.sleep(0.001)
        ser.break_condition = False
        time.sleep(0.00001)
        ser.write(frame)
        ser.close()

        status_label.configure(text=f"Sent: Addr={address}, Mode={color_mode_menu.get()}", text_color="green")
    except Exception as e:
        status_label.configure(text=f"Error: {e}", text_color="red")

# GUI layout
title_label = ctk.CTkLabel(app, text="DMX Address Controller", font=ctk.CTkFont(size=18, weight="bold"))
title_label.pack(pady=10)

port_label = ctk.CTkLabel(app, text="Port")
port_label.pack()
port_menu = ctk.CTkOptionMenu(app, values=get_ports())
port_menu.pack()

address_label = ctk.CTkLabel(app, text="DMX Address (1â€“509)")
address_label.pack()
address_entry = ctk.CTkEntry(app)
address_entry.pack()

color_mode_label = ctk.CTkLabel(app, text="Color Mode")
color_mode_label.pack()
color_mode_menu = ctk.CTkOptionMenu(app, values=["RGB", "RGBW"])
color_mode_menu.pack()

submit_btn = ctk.CTkButton(app, text="Submit", command=send_config)
submit_btn.pack(pady=10)

status_label = ctk.CTkLabel(app, text="")
status_label.pack()

app.mainloop()
